# 白名单配置测试指南

## 测试目标
验证JWT过滤器的白名单机制是否正常工作，确保未登录用户可以访问必要的接口。

## 测试环境
- 应用地址: `http://localhost:8080`
- 测试工具: curl 或 Postman

## 测试用例

### 1. 测试登录接口（应该成功）

#### 用户登录
```bash
curl -X POST http://localhost:8080/user/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "123456"
  }'
```

**预期结果**: 返回登录成功信息，包含JWT令牌

### 2. 测试用户注册接口（应该成功）

```bash
curl -X POST http://localhost:8080/users \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456",
    "phone": "13800138099",
    "gender": "男"
  }'
```

**预期结果**: 返回成功信息，用户创建成功

### 3. 测试头像上传接口（应该成功）

```bash
curl -X POST http://localhost:8080/upload \
  -F "file=@test.jpg"
```

**预期结果**: 返回文件上传成功，返回文件URL

### 4. 测试受保护接口（应该返回401）

#### 查询用户信息
```bash
curl http://localhost:8080/users/1
```

**预期结果**: 返回401状态码，表示需要登录

#### 查询所有用户
```bash
curl http://localhost:8080/users
```

**预期结果**: 返回401状态码，表示需要登录

## 测试步骤

### 步骤1: 启动应用
确保Spring Boot应用正常运行在8080端口

### 步骤2: 测试白名单接口
按顺序执行上述测试用例1-3，验证无需登录即可访问

### 步骤3: 测试受保护接口
执行测试用例4，验证需要登录才能访问

### 步骤4: 查看日志
检查应用日志，确认白名单路径的访问日志

## 日志验证

### 白名单访问日志
```
INFO  - 白名单路径: /login, 放行
INFO  - 白名单路径: /users, 放行
INFO  - 白名单路径: /upload, 放行
```

### 受保护接口日志
```
INFO  - 令牌为空, 响应401
```

## 常见问题排查

### 问题1: 白名单接口仍然返回401
**可能原因**:
- 路径不匹配（注意大小写和前缀）
- 过滤器配置未生效
- 应用未重启

**解决方案**:
- 检查请求路径是否完全匹配白名单
- 重启应用
- 查看日志确认过滤器是否正常工作

### 问题2: 某些路径无法访问
**可能原因**:
- 路径不在白名单中
- 业务逻辑层面的权限控制

**解决方案**:
- 将需要的路径添加到白名单
- 检查业务代码中的权限控制逻辑

### 问题3: 静态资源无法访问
**可能原因**:
- 静态资源路径配置不正确
- 白名单路径不匹配

**解决方案**:
- 确认静态资源的实际访问路径
- 调整白名单配置

## 性能测试

### 白名单检查性能
白名单检查使用简单的字符串包含匹配，性能开销很小，适合高频访问。

### 建议
- 白名单路径数量控制在20个以内
- 避免使用过于复杂的路径匹配逻辑
- 定期清理不需要的白名单路径

## 安全测试

### 测试未授权访问
尝试访问一些敏感接口，确保它们不在白名单中：
- 用户管理接口
- 系统配置接口
- 数据查询接口

### 验证结果
所有敏感接口都应该返回401状态码，表示需要登录。

## 总结

通过以上测试，可以验证：
1. ✅ 白名单接口可以正常访问
2. ✅ 受保护接口正确返回401
3. ✅ 日志记录正常
4. ✅ 安全性得到保障

如果所有测试都通过，说明白名单配置工作正常，用户可以在未登录状态下进行注册和头像上传等操作。
